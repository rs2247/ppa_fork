{"version":3,"sources":["web/static/js/sales-report.js"],"names":["select2","require","PAGE_URL","SalesReportPage","$levelFilterSelect","width","height","placeholder","$kindFilterSelect","startDatePicker","DatePicker","endDatePicker","removeWhitelabelsCheckbox","universityFilter","UniversityFilter","submit","evt","preventDefault","updateReport","updateRequest","AjaxRequest","url","onSuccess","afterShowReport","onLoadOverlayElement","loadInitialFilterValues","loadInitialValues","yesterday","subtract","toDate","sixMonthsBehind","startDate","val","endDate","setDate","data","collectParameters","console","log","JSON","stringify","attr","getAndRenderPartial","updatePageHistory","params","$","param","window","history","pushState","getValue","start_date","end_date","university_filter_type","universityTypeDropdown","getSelectedValue","university_id","universityAutocomplete","education_group_id","educationGroupAutocomplete","admin_id","Authentication","getCurrentUserId","remove_whitelabels","is","level","kind","dataTable","DataTable","paging","deferRender","pageLength","order","removeAttr","salesReportPage"],"mappings":"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","file":"priv/static/js/sales-report.js","sourcesContent":["import DatePicker from \"./components/datepicker\";\nimport moment from 'moment';\nimport AjaxRequest from \"./components/ajax\";\nimport Authentication from \"./components/authentication\";\nimport DataTable from \"./components/datatable\";\nimport UniversityFilter from \"./components/universityFilter\";\nimport $ from 'jquery'\n\nlet select2 = require('select2')();\n\nconst PAGE_URL = 'sales_stats';\n\nclass SalesReportPage {\n\n  setup() {\n    this.$levelFilterSelect = $('.js-levels-multi-select');\n    this.$levelFilterSelect.select2({width: \"resolve\", height: \"resolve\", placeholder: \"Todos\"});\n    this.$kindFilterSelect = $('.js-kinds-multi-select');\n    this.$kindFilterSelect.select2({width: \"resolve\", height: \"resolve\", placeholder: \"Todos\"});\n    this.startDatePicker = new DatePicker(\"start-date\");\n    this.endDatePicker = new DatePicker(\"end-date\");\n    this.removeWhitelabelsCheckbox = $(\"#remove-whitelabels\");\n    this.universityFilter = new UniversityFilter();\n\n    $(\"#filters-form\").submit((evt) => {\n      evt.preventDefault();\n      this.updateReport();\n    });\n\n    this.updateRequest = new AjaxRequest({\n        url: `/${PAGE_URL}/generate`,\n        onSuccess: () => this.afterShowReport(),\n        onLoadOverlayElement: $(\".report-panel\")\n    });\n    this.loadInitialFilterValues();\n    this.universityFilter.loadInitialValues();\n    this.afterShowReport();\n  }\n\n  loadInitialFilterValues() {\n    let yesterday = moment().subtract(1, 'days').toDate();\n    let sixMonthsBehind = moment().subtract(1, 'days').subtract(6, 'months').toDate();\n\n    let startDate = $(\"#initial-start-date\").val() || sixMonthsBehind;\n    let endDate = $(\"#initial-end-date\").val() || yesterday;\n    this.startDatePicker.setDate(startDate);\n    this.endDatePicker.setDate(endDate);\n  }\n\n  updateReport() {\n    const data = this.collectParameters();\n    console.log(\"Filter Data: \" + JSON.stringify(data));\n    $(\"#update-btn\").attr('disabled', '');\n    this.updateRequest.getAndRenderPartial(data, $(\"#report-container\"));\n    this.updatePageHistory(data);\n  }\n\n  updatePageHistory(data) {\n    const params = $.param(data);\n    window.history.pushState(\"\", \"\", `${PAGE_URL}?${params}`);\n  }\n\n  collectParameters() {\n    console.log(this.startDatePicker.getValue())\n    return {\n      start_date: this.startDatePicker.getValue(),\n      end_date: this.endDatePicker.getValue(),\n      university_filter_type: this.universityFilter.universityTypeDropdown.getSelectedValue(),\n      university_id: this.universityFilter.universityAutocomplete.getSelectedValue(),\n      education_group_id: this.universityFilter.educationGroupAutocomplete.getSelectedValue(),\n      admin_id: Authentication.getCurrentUserId(),\n      remove_whitelabels: this.removeWhitelabelsCheckbox.is(\":checked\"),\n      level: this.$levelFilterSelect.val(),\n      kind: this.$kindFilterSelect.val(),\n    }\n  }\n\n  afterShowReport() {\n    this.dataTable = new DataTable('#report-table', {\n      paging: true,\n      deferRender: true,\n      pageLength: 10,\n      order: [0, 'asc']\n    });\n    $(\"#update-btn\").removeAttr('disabled');\n  }\n}\n\nwindow.salesReportPage = new SalesReportPage();\n"]}